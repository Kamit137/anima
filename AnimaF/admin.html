<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - Вход и регистрация</title>
     <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
        }

        .form-container {
            padding: 40px 30px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #eaeaea;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #777;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #2575fc;
            border-bottom: 2px solid #2575fc;
        }

        .form {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .form.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: border 0.3s ease;
        }

        input:focus {
            border-color: #2575fc;
            outline: none;
            box-shadow: 0 0 0 2px rgba(37, 117, 252, 0.2);
        }

        .error {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        button[type="submit"] {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 117, 252, 0.4);
        }

        button[type="submit"]:active {
            transform: translateY(0);
        }

        .message {
            padding: 12px;
            border-radius: 6px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab active" data-tab="login">Вход</button>
            <button class="tab" data-tab="register">Регистрация</button>
        </div>

        <div class="form-container">
            <!-- Форма входа -->
            <form id="loginForm" class="form active">
                <h2>Вход в админ-панель</h2>

                <div class="input-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" name="email" required>
                    <div class="error" id="loginEmailError">Введите корректный email</div>
                </div>

                <div class="input-group">
                    <label for="loginPassword">Пароль</label>
                    <input type="password" id="loginPassword" name="password" required>
                    <div class="error" id="loginPasswordError">Пароль должен содержать не менее 6 символов</div>
                </div>

                <button type="submit" id="loginSubmit">
                    <span class="button-text">Войти</span>
                </button>

                <div class="message" id="loginMessage"></div>
            </form>

            <!-- Форма регистрации -->
            <form id="registerForm" class="form">
                <h2>Регистрация</h2>

                <div class="input-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" name="email" required>
                    <div class="error" id="registerEmailError">Введите корректный email</div>
                </div>

                <div class="input-group">
                    <label for="registerPassword">Пароль</label>
                    <input type="password" id="registerPassword" name="password" required>
                    <div class="error" id="registerPasswordError">Пароль должен содержать не менее 6 символов</div>
                </div>

                <div class="input-group">
                    <label for="confirmPassword">Подтвердите пароль</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                    <div class="error" id="confirmPasswordError">Пароли не совпадают</div>
                </div>

                <button type="submit" id="registerSubmit">
                    <span class="button-text">Зарегистрироваться</span>
                </button>

                <div class="message" id="registerMessage"></div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Переключение между вкладками
            const tabs = document.querySelectorAll('.tab');
            const forms = document.querySelectorAll('.form');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');

                    // Активируем выбранную вкладку
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    // Показываем выбранную форму
                    forms.forEach(form => {
                        form.classList.remove('active');
                        if (form.id === tabName + 'Form') {
                            form.classList.add('active');
                        }
                    });
                });
            });

            // Валидация email
            function validateEmail(email) {
                const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(String(email).toLowerCase());
            }

            // Валидация пароля
            function validatePassword(password) {
                return password.length >= 6;
            }

            // Функция для отправки данных после успешной регистрации
            function sendUserData(email, password) {
                const userData = {
                    Email: email,
                    Password: password,
                    Actions: {
                        read: true
                    }
                };

                fetch('/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Ошибка отправки данных пользователя');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Данные пользователя успешно отправлены:', data);
                })
                .catch(error => {
                    console.error('Ошибка при отправке данных пользователя:', error);
                });
            }

            // Обработка формы входа
            const loginForm = document.getElementById('loginForm');
            const loginEmail = document.getElementById('loginEmail');
            const loginPassword = document.getElementById('loginPassword');
            const loginEmailError = document.getElementById('loginEmailError');
            const loginPasswordError = document.getElementById('loginPasswordError');
            const loginSubmit = document.getElementById('loginSubmit');
            const loginMessage = document.getElementById('loginMessage');

            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();

                let isValid = true;

                // Валидация email
                if (!validateEmail(loginEmail.value)) {
                    loginEmailError.style.display = 'block';
                    isValid = false;
                } else {
                    loginEmailError.style.display = 'none';
                }

                // Валидация пароля
                if (!validatePassword(loginPassword.value)) {
                    loginPasswordError.style.display = 'block';
                    isValid = false;
                } else {
                    loginPasswordError.style.display = 'none';
                }

                if (isValid) {
                    // Показываем индикатор загрузки
                    const buttonText = loginSubmit.querySelector('.button-text');
                    buttonText.innerHTML = '<div class="loading"></div>Вход...';
                    loginSubmit.disabled = true;

                    // Отправляем данные на сервер
                    const data = {
                        email: loginEmail.value,
                        password: loginPassword.value
                    };

                    fetch('/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Ошибка сети');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Скрываем индикатор загрузки
                        buttonText.textContent = 'Войти';
                        loginSubmit.disabled = false;

                        // Обрабатываем ответ сервера
                        if (data.success) {
                            loginMessage.textContent = 'Вход выполнен успешно!';
                            loginMessage.className = 'message success';
                            loginMessage.style.display = 'block';

                            // Перенаправляем пользователя
                            setTimeout(() => {
                                window.location.href = '/admin';
                            }, 1000);
                        } else {
                            loginMessage.textContent = data.message || 'Ошибка входа';
                            loginMessage.className = 'message error-message';
                            loginMessage.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        // Скрываем индикатор загрузки
                        buttonText.textContent = 'Войти';
                        loginSubmit.disabled = false;

                        loginMessage.textContent = 'Ошибка соединения с сервером';
                        loginMessage.className = 'message error-message';
                        loginMessage.style.display = 'block';
                        console.error('Ошибка:', error);
                    });
                }
            });

            // Обработка формы регистрации
            const registerForm = document.getElementById('registerForm');
            const registerEmail = document.getElementById('registerEmail');
            const registerPassword = document.getElementById('registerPassword');
            const confirmPassword = document.getElementById('confirmPassword');
            const registerEmailError = document.getElementById('registerEmailError');
            const registerPasswordError = document.getElementById('registerPasswordError');
            const confirmPasswordError = document.getElementById('confirmPasswordError');
            const registerSubmit = document.getElementById('registerSubmit');
            const registerMessage = document.getElementById('registerMessage');

            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();

                let isValid = true;

                // Валидация email
                if (!validateEmail(registerEmail.value)) {
                    registerEmailError.style.display = 'block';
                    isValid = false;
                } else {
                    registerEmailError.style.display = 'none';
                }

                // Валидация пароля
                if (!validatePassword(registerPassword.value)) {
                    registerPasswordError.style.display = 'block';
                    isValid = false;
                } else {
                    registerPasswordError.style.display = 'none';
                }

                // Проверка совпадения паролей
                if (registerPassword.value !== confirmPassword.value) {
                    confirmPasswordError.style.display = 'block';
                    isValid = false;
                } else {
                    confirmPasswordError.style.display = 'none';
                }

                if (isValid) {
                    // Показываем индикатор загрузки
                    const buttonText = registerSubmit.querySelector('.button-text');
                    buttonText.innerHTML = '<div class="loading"></div>Регистрация...';
                    registerSubmit.disabled = true;

                    // Отправляем данные на сервер
                    const data = {
                        email: registerEmail.value,
                        password: registerPassword.value
                    };

                    fetch('/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Ошибка сети');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Скрываем индикатор загрузки
                        buttonText.textContent = 'Зарегистрироваться';
                        registerSubmit.disabled = false;

                        // Обрабатываем ответ сервера
                        if (data.success) {
                            registerMessage.textContent = 'Регистрация прошла успешно!';
                            registerMessage.className = 'message success';
                            registerMessage.style.display = 'block';

                            // Отправляем данные пользователя на бекенд
                            sendUserData(registerEmail.value, registerPassword.value);

                            // Перенаправляем на главную страницу
                            setTimeout(() => {
                                window.location.href = '/';
                            }, 1500);
                        } else {
                            registerMessage.textContent = data.message || 'Ошибка регистрации';
                            registerMessage.className = 'message error-message';
                            registerMessage.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        // Скрываем индикатор загрузки
                        buttonText.textContent = 'Зарегистрироваться';
                        registerSubmit.disabled = false;
                        
                        registerMessage.textContent = 'Ошибка соединения с сервером';
                        registerMessage.className = 'message error-message';
                        registerMessage.style.display = 'block';
                        console.error('Ошибка:', error);
                    });
                }
            });
            
            // Очистка сообщений при изменении полей
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    const message = this.closest('form').querySelector('.message');
                    if (message) {
                        message.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>